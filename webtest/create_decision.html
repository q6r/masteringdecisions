
<html>

<body>

	<form>
		<input type="submit" id="testcreate" value="Create test person"></input>

	</form>


		<h1>Decision</h1>
		
		<label for="pid">person_id</label>
		<input type="text" id="pid"></input>
		<br />

		<label for="name">name</label>
		<input type="text" id="name"></input>
		<br />

		<label for="desc">description</label>
		<input type="text" id="desc"></input>
		<br />

		<label for="oid">owner_id</label>
		<input type="text" id="oid"></input>
		<br />

		<label for="stg">stage</label>
		<input type="text" id="stg"></input>
		<br />

		<label for="cstyle">crit vote style</label>
		<input type="text" id= "cstyle"></input>	
		<br />

		<label for="astyle">alt vote style</label>
		<input type="text" id="astyle"></input>
		<br />

		<label for="settings">settings</label>
		<input type="text" id="settings"></input>
		<br />	



		<input type="submit" id="testdec" value="create decision"></input>

	<form>
		<h1>Criterions</h1>		

		<label for="crit_dec_id">decision id</label>
		<input type="text" id="crit_dec_id"></input>
		<br />

		<label for="crit1_name">Crit 1 name</label>
		<input type="text" id="crit1_name"></input>
		<br />

		<label for="crit1_wt">Crit 1 weight</label>
		<input type="text" id="crit1_wt"></input>
		<br />

		<label for="crit2_name">Crit 2 name</label>
		<input type="text" id="crit2_name"></input>
		<br />

		<label for="crit2_wt">Crit 2 weight</label>
		<input type="text" id="crit2_wt"></input>
		<br />


		<input type="submit" id="crit_add" value="add criterions"></input>


	</form>


	<form>
		<h1>Alternatives</h1>

		<label for="alt_dec_id">decision id</label>
		<input type="text" id="alt_dec_id"></input>
		<br />


		<label for="alt1_name">Alt 1 name</label>
		<input type="text" id="alt1_name"></input>
		<br />

		<label for="alt1_rt">Alt 1 rating</label>
		<input type="text" id="alt1_rt"></input>
		<br />


		<label for="alt2_name">Alt 2 name</label>
		<input type="text" id="alt2_name"></input>
		<br />

		<label for="alt2_rt">Alt 2 rating</label>
		<input type="text" id="alt2_rt"></input>
		<br />

		<input type="submit" id="alt_add" value="add alternatives"></input>
	</form>

	<form>
		<h1>Create a ballot</h1>

		<label for="bal_dec_id">decision id</label>
		<input type="text" id="bal_dec_id"></input>
		<br />

		<label for="bal_name">Name</label>
		<input type="text" id="bal_name"></input>
		<br />

		<label for="bal_email">Email</label>
		<input type="text" id="bal_email"></input>
		<br />


		<input type="submit" id="bal_add" value="add ballot"></input>


	</form>





<script>


var base_url = "http://localhost:9999";

get_text = function(url, cb) {
	var request = new XMLHttpRequest();
	request.open('GET', base_url+url, true);
	request.setRequestHeader("Content-Type", "application/json");

	request.onreadystatechange = function() {
		if(request.readyState == 4 && request.status == 200) {
			cb(JSON.parse(request.responseText));
		}
	}

	request.send();
}

post_text = function(url, data, cb) {
	var request = new XMLHttpRequest();
	request.open('POST', base_url+url, true);
	request.setRequestHeader("Content-Type", "application/json");

	request.onreadystatechange = function() {
		if(request.readyState == 4 && request.status == 200) {
			cb(JSON.parse(request.responseText));
		}
	}

	request.send(data);
}

function assert(condition, message) {
    if (!condition) {
        throw message || "Assertion failed";
    }
}

function create_person(person, cb) {
	post_text("/person", JSON.stringify(person), cb)
}



document.getElementById("testcreate").onclick = function () {


	new_person = {
		"email": "jln3@pdx.edu",
		"pw_hash":"bloopr",
		"name_first":"Jasons",
		"name_last":"Nelsons"}

	create_person(new_person, function (person) {
	
		assert(person["email"] == "jln3@pdx.edu", "Wrong email");


	});
}

document.getElementById("testdec").onclick = function () {

//	new_login = {
//		"email":"jln3@pdx.edu",
//		"password":"bloopr"}
	
//	post_text("/login", JSON.stringify(new_login), function (result) {
//		console.log(result);
//	});


//	get_text("/whoami", function (result) {
//
//		console.log(result["error"]);
//
//	});

	new_decision = {
		"person_id":+document.getElementById("pid").value,
		"name":document.getElementById("name").value,
		"description":document.getElementById("desc").value,
		"owner_id":+document.getElementById("oid").value,
		"stage":+document.getElementById("stg").value,
		"criterion_vote_style":document.getElementById("cstyle").value,
		"alternative_vote_style":document.getElementById("astyle").value,
		"client_settings":document.getElementById("settings").value
		
	};	


	post_text("/decision", JSON.stringify(new_decision), function(decision) {

		console.log(decision.decision_id);

	});




}


document.getElementById("crit_add").onclick = function() {
	crit1 = {"name":document.getElementById("crit1_name").value,
		 "weight":+document.getElementById("crit1_wt").value};	

	crit2 = {"name":document.getElementById("crit2_name").value,
		"weight":+document.getElementById("crit2_wt").value};

	crits = [crit1, crit2];	

	for(var i in crits) {
		crit = crits[i];

		post_text("/decision/"+document.getElementById("crit_dec_id").value+"/criterion", JSON.stringify(crit), function(c) {

			console.log(c.criterion_id);

		});


	}

}

document.getElementById("alt_add").onclick = function() {

	alt1 = {"name":document.getElementById("alt1_name").value,
		 "rating":+document.getElementById("alt1_rt").value};	

	alt2 = {"name":document.getElementById("alt2_name").value,
		"rating":+document.getElementById("alt2_rt").value};

	alts = [alt1, alt2];	

	for(var i in alts) {
		alt = alts[i];

		post_text("/decision/"+document.getElementById("alt_dec_id").value+"/alternative", JSON.stringify(alt), function(a) {

			console.log(a);

		});

	}
}

// /decision/decision id/ballot
// name email

document.getElementById("bal_add").onclick = function() {


	new_ballot = {
		"name":document.getElementById("bal_name").value,
		"email":document.getElementById("bal_email").value 
	};

	post_text("/decision/"+document.getElementById("bal_dec_id").value+"/ballot", JSON.stringify(new_ballot), function(b) {

		console.log(b);

	});


	


}



</script>

</body>
</html>

